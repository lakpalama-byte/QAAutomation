pipeline {
    agent any

   environment {
           JAVA_HOME = "/opt/homebrew/Cellar/openjdk/22.0.2/libexec/openjdk.jdk/Contents/Home"
           M2_HOME = "/opt/homebrew/Cellar/maven/3.9.8/libexec"
           PATH = "${M2_HOME}/bin:${JAVA_HOME}/bin:${env.PATH}"
       }


    stages {




        stage('Checkout') {
            steps {
                checkout ([
                $class: 'GitSCM',
                userRemoteConfigs: [[ url: 'https://github.com/lakpalama-byte/QAAutomation.git']] ,
                branches: [[ name: 'dev']]

                ])

            }
        }

        stage('Build') {
            // Run Maven clean and package commands
                            sh '''
                            ${M2_HOME}/bin/mvn clean package
                            '''
        }

        stage('Run Tests') {
            steps {
                            // Run Maven tests
                            sh '''
                            ${M2_HOME}/bin/mvn test
                            '''
                        }
        }

        stage('Archive Artifacts') {
                    steps {
                        // Archive the generated JAR file
                        archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
                    }
                }

           stage('Generate Reports') {
            steps {
                // Generate Cucumber reports
                cucumber 'target/cucumber-reports/*.json'
            }
        }



    }

     post {
         always {
             // Archive test results
             junit 'target/surefire-reports/*.xml'
             cucumber 'target/cucumber-reports/*.json'
         }
     }

}
