pipeline {
    agent any

    environment {
        MAVEN_HOME = '/opt/homebrew/Cellar/maven/3.9.8/libexec'
    }

    stages {


        stage('SSH to EC2')  {
        steps {

         sshCommand remote: [host: '3.236.134.199', user: 'ec2-user', identityFile: 'C:\Users\sapan\OneDrive\Desktop\TECH_LEARN_24\DevOps\Credential_mgmt.ssh/auth_key.pem'], command: 'echo "Hello EC2"']
        }
        }



        stage('Checkout') {
            steps {
                checkout ([
                $class: 'GitSCM',
                userRemoteConfigs: [[ url: 'https://github.com/lakpalama-byte/QAAutomation.git']] ,
                branches: [[ name: '*dev']]

                ])

            }
        }

        stage('Build') {
            steps {
                // Build the project using Maven
                sh '''${MAVEN_HOME}/bin/mvn clean install'''
            }
        }

        stage('Run Tests') {
            steps {
                // Run the tests using Maven
                sh '''${MAVEN_HOME}/bin/mvn test'''
            }
        }

           stage('Generate Reports') {
            steps {
                // Generate Cucumber reports
                cucumber 'target/cucumber-reports/*.json'
            }
        }
    }

     post {
         always {
             // Archive test results
             junit 'target/surefire-reports/*.xml'
             cucumber 'target/cucumber-reports/*.json'
         }
     }

}
