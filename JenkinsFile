pipeline {
    agent any

    environment {
        M2_HOME = '/opt/Maven'  // Remove space here
        PATH = "${M2_HOME}/bin:${env.PATH}"
    }


    stages {




        stage('Checkout') {
            steps {
                checkout ([
                $class: 'GitSCM',
                userRemoteConfigs: [[ url: 'https://github.com/lakpalama-byte/QAAutomation.git']] ,
                branches: [[ name: 'dev']]

                ])

            }
        }

        stage('Build') {
            steps {
                // Build the project using Maven
                sh '''${M2_HOME}/bin/mvn clean package'''
            }
        }

        stage('Run Tests') {
            steps {
                // Run the tests using Maven
                sh '''${M2_HOME}/bin/mvn test'''
            }
        }

           stage('Generate Reports') {
            steps {
                // Generate Cucumber reports
                cucumber 'target/cucumber-reports/*.json'
            }
        }
    }

     post {
         always {
             // Archive test results
             junit 'target/surefire-reports/*.xml'
             cucumber 'target/cucumber-reports/*.json'
         }
     }

}
